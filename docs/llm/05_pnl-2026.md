---
# 2026 P&L Projection Page (Concept Map)

## Purpose
- pages/01_2026 P&L Projection.py의 개념적 모듈/입력·출력 범주만 빠르게 파악하도록 합니다.

## Audience
- Primary: 외부 LLM / 신규 투입된 LLM 에이전트
- Secondary: 신규 개발자, 운영/분석 담당자

## Scope
- In-scope:
  - A~D 모듈명(Backlog, 삼성 계획, 온라인 리텐션, Upsell, 신규 Gap) 개요
  - 필요한 입력 범주와 산출물 범주(매출/OP/KPI/표) 요약
  - 검증 및 TODO 위치 안내
- Out-of-scope:
  - 산식/룩업 규칙의 세부 단계
  - UI 구성/차트 상세

## Sources of truth (do not guess)
- (반드시 링크로) 이 문서는 아래 파일만을 근거로 한다:
  - ../README.md
  - ../implementation.md
  - ../data-sources.md
  - ../database.md
  - ../pages.md
  - ../context-bridge.md
  - ../TODO.md
  - (필요 시) ../../<레포 상단의 txt 문서들> (예: B2B 제품/조직/어카운트 전략 문서)

## Update triggers
- pages/01_2026 P&L Projection.py 로직/모듈이 변경될 때
- KPI/입력 슬라이더/출력 테이블 구성이 바뀔 때

## Open questions / TODO
- TODO: docs/TODO.md의 검증 항목이 해소되면 본 문서 업데이트
---

## Why this page exists
- 2025년 Won 딜 데이터를 기반으로 2026년 매출/OP를 시뮬레이션하여 Backlog/삼성 계획/리텐션/업셀/신규 Gap의 기여도를 확인하고 목표 달성 여부를 점검하기 위함 (`../context-bridge.md`).

## Inputs (explicit in code)
- 기본 데이터: `load_won_deal()` → 2025년 체결일이 2025년인 Won 딜, `수주 예정액(종합)`을 억 단위 변환
- 사용자 입력(사이드바, `SimulationInputs`):
  - `online_target`, `offline_target` (년 매출 목표, 억)
  - `monthly_marketing`, `monthly_payroll` (억)
  - `online_margin`, `offline_margin` (공헌이익률)
  - `samsung_online`, `samsung_offline` (월별 계획, 억)
- 데이터 파생: 상위채널(포맷→온라인/출강), S-tier(체결액 기준), 리드타임/교육기간 Median 룩업 (상위채널×기업규모×S-tier → 채널×규모 → 채널, 최소 샘플 5)
- 업로드 대체 입력: 코드에 업로드 지원 로직이 있으나 기본은 `load_won_deal()` 사용 (`../implementation.md`)

## Modules (A~D)
- A. Backlog: 2026년과 교육기간이 겹치는 2025 Won 딜을 일별 안분해 2026 매출 계산
- B. 삼성 계획: 월별 입력값(온라인/출강)을 12개월 반복하여 삼성전자 딜 생성(채널별 포맷, S-tier 부여)
- C1. 온라인 리텐션: 비삼성 온라인 딜을 +365일 이동, 2026과 겹치는 딜만 포함
- C2. Upsell: 비삼성 출강 딜을 기업별 합산 후 P-tier 배수(금액 구간별) 적용, 원 평균 월에 2026 업셀 딜 생성(리드타임/교육기간 룩업 적용)
- D. 신규 Deals: A~C 매출 합산 후 채널별 목표 대비 Gap을 기업규모 비중(2025 실적)과 계절 가중치(온라인 4/2/2/4, 출강 5/3/2/2)로 월/규모 배분, 리드타임/교육기간을 적용해 체결액 역산

## Core pipeline
1. 전처리: 날짜 캐스팅, 체결일 생성(계약일 → 수주예정일 → 생성 날짜), 2025년 체결 필터, S-tier/리드타임/교육기간 계산
2. Median 룩업 테이블 생성: 상위채널×기업규모×S-tier → 채널×규모 → 채널. 샘플 < min_sample(5)이면 상위 단계/기본값 fallback
3. 모듈별 딜 생성(A~D), 각 딜에 교육기간/체결액/채널/포맷/기업규모/모듈 라벨 부여
4. `compute_monthly_allocation`으로 2026년 달력 기준 일별 안분 → `monthly_rev`(길이 12 배열), `rev_2026`(합계)
5. P&L 집계: 채널별 매출 → 공헌이익(마진 적용) → 고정비(제작 0.2/월, 마케팅 입력, 인건비 입력, 임대=인건비×15%, 기타=1+출강5%) → OP/OP Margin/성장률/Rule of 50/인건비 비율
6. 출력 테이블: 모듈별 매출 기여, 월별 P&L(체결액/매출/공헌/고정비 세부), 연간 P&L 요약, 고정비 상세, 2027/2028 이후 이월 매출, 시뮬레이션 딜 CSV 다운로드

## Assumptions & knobs (from code)
- 금액 단위: 억 (`WON_PER_EOK = 100_000_000`)
- 리드타임/교육기간 기본 fallback: 전체 Median (리드타임/교육기간) if 룩업 실패
- Upsell 배수(`upsell_multiplier`): S3≥1억→1.1, ≥0.5→1.25, ≥0.25→1.5, 나머지 2.0
- 계절 가중치: 온라인 4/2/2/4, 출강 5/3/2/2 (분기 내 균등, 총합 1로 정규화)
- 기타 비용: 1억/월 + 출강 매출 5%
- TODO: 업로드 입력 형식/필수 컬럼 명세는 코드 외 근거 없음 → 근거 확인 시 보강

## Validation checklist
- 샘플 수 부족: Median 룩업 sample<5인 조합이 많은지 확인, fallback 적용 여부 검토 (`../TODO.md`)
- 모듈별 매출 0 여부: Backlog/Retention/Upsell이 0이면 필터/컬럼 맵 확인 (`../TODO.md`)
- Gap 충족: 신규 딜 생성 후 목표 대비 차이가 0 근접인지, 기업 규모 분배가 기대와 일치하는지
- 금액 단위: 모든 금액이 억 단위인지 확인, 원 단위 데이터 섞이지 않도록
- 리텐션 제외: 온라인 리텐션에서 삼성/미최초 입과 제외 로직 적용 여부 확인

## Known TODOs (from docs/TODO.md, context-bridge)
- 모듈별 매출이 0이 아닌지 실데이터로 검증, 컬럼/필터 현업 확인
- Median Lookup 샘플 수 <5 처리 규칙과 기본값/가중치 검토
- 신규/Upsell 딜 결과가 목표 매출을 정확히 충족하는지, 기업 규모 분배 sanity-check
- UI/표시 포맷 피드백 후 개선 항목 정의

## Safe modification guide
- 가정값만 변경: `SimulationInputs` 기본값, `upsell_multiplier`, 가중치/마진/고정비 상수 → 변경 후 `CODE_SIG` 업데이트 권장
- 모듈 추가/제거: `run_simulation`에서 모듈 생성/concat 위치 수정, `module_breakdown_table`와 KPI 영향 점검, 문서 업데이트
- 입력 템플릿 변경: 업로드 로직/필수 컬럼 변경 시 전처리(`preprocess_data`)와 UI 설명 동기화, 에러 메시지 추가, 문서 업데이트
